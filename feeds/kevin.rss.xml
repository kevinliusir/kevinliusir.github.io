<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kevin's Blog</title><link>http://www.feisblog.com/</link><description>专注自动化运维、大数据、云计算</description><atom:link href="http://www.feisblog.com/feeds%5Ckevin.rss.xml" rel="self"></atom:link><lastBuildDate>Thu, 08 Jan 2015 10:30:00 +0800</lastBuildDate><item><title>Puppet(二)简单安装配置Apache</title><link>http://www.feisblog.com/pages/2015/01/08/puppet_install_Apache/</link><description>&lt;h1&gt;Puppet(二)简单安装配置Apache&lt;/h1&gt;
&lt;p&gt;操作系统：CentOS6.6&lt;br /&gt;
master.feisblog.com 192.168.212.100 &lt;br /&gt;
agent.feisblog.com  192.168.212.110&lt;/p&gt;
&lt;h2&gt;1. 创建模块目录&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;#mkdir -p /etc/puppet/modules/httpd/{manifests,templates,files}&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;2. 创建安装httpd类&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c-Singleline"&gt;#httpd/manifests/install.pp &lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="n"&gt;httpd::install&lt;/span&gt; { 
     &lt;span class="k"&gt;package&lt;/span&gt; { [ &lt;span class="s"&gt;&amp;quot;httpd&amp;quot;&lt;/span&gt; ]: 
   &lt;span class="n"&gt;ensure&lt;/span&gt; =&amp;gt; &lt;span class="n"&gt;present&lt;/span&gt;,
   }
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;3. 创建启动httpd服务类&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;**httpd/manifests/service.pp**   
class httpd::service {
  service { &amp;quot;httpd&amp;quot;:
    ensure =&amp;gt; running,
    hasstatus =&amp;gt; true,
    hasrestart =&amp;gt; true,
    enable =&amp;gt; true,
    require =&amp;gt; Class[&amp;quot;httpd::install&amp;quot;],
  }
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;4. 创建httpd 配置文件类，配置文件通过puppet获取（目录：/etc/puppet/modules/httpd/files/httpd.conf）&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;**#httpd/manifests/conf.pp**
class httpd::conf {
  file { &amp;quot;httpd.conf&amp;quot;:
    ensure =&amp;gt; present,
    owner =&amp;gt; &amp;#39;root&amp;#39;,
    group =&amp;gt; &amp;#39;root&amp;#39;,
    mode =&amp;gt; &amp;#39;644&amp;#39;,
    path =&amp;gt; &amp;#39;/etc/httpd/conf/httpd.conf&amp;#39;,
    source =&amp;gt; &amp;#39;puppet:///modules/httpd/httpd.conf&amp;#39;,
    require =&amp;gt; Class[&amp;quot;httpd::install&amp;quot;], 
    notify =&amp;gt; Class[&amp;quot;httpd::service&amp;quot;], 
  }
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;5. 创建主配置文件init.pp&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;**httpd/manifests/init.pp **
class httpd { 
    include httpd::install, httpd::service, httpd::conf
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;6. 配置客户端节点&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;#vim /etc/puppet/manifests/nodes/agent.feisblog.com.pp
node &amp;#39;agent.feisblog.com&amp;#39; {
    include httpd
}
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;7. 将节点载入puppet的site.pp 文件&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt; &lt;span class="c"&gt;#vim /etc/puppet/manifests/site.pp&lt;/span&gt;
 &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;nodes/agent.feisblog.com.pp&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;8. 在agent端&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;#puppet agent --test --server master.feisblog.com --noop&lt;/code&gt;
&lt;code&gt;#puppet agent --test --server master.feisblog.com&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kevin</dc:creator><pubDate>Thu, 08 Jan 2015 10:30:00 +0800</pubDate><guid>tag:www.feisblog.com,2015-01-08:pages/2015/01/08/puppet_install_Apache/</guid><category>puppet</category></item><item><title>Puppet(一) 安装</title><link>http://www.feisblog.com/pages/2015/01/07/puppet_install/</link><description>&lt;h3&gt;环境介绍：&lt;/h3&gt;
&lt;p&gt;操作系统：Centos6.6&lt;br /&gt;
master.
feisblog.com    192.168.212.100 &lt;br /&gt;
agent.feisblog.com  192.168.212.110&lt;/p&gt;
&lt;p&gt;1安装Centos EPEL 源
&lt;code&gt;#rpm -ivh  http://mirrors.yun-idc.com/epel/6/x86_64/epel-release-6-8.noarch.rpm&lt;/code&gt; &lt;br /&gt;
2.安装puppetLabs 源
&lt;code&gt;#rpm -ivh http://yum.puppetlabs.com/el/6Server/products/x86_64/puppetlabs-release-6-11.noarch.rpm&lt;/code&gt; &lt;br /&gt;
3.安装服务器端&lt;br /&gt;
&lt;code&gt;#yum install puppet-server&lt;/code&gt; &lt;br /&gt;
检查安装： &lt;br /&gt;
&lt;code&gt;#puppet -V&lt;/code&gt; &lt;br /&gt;
&lt;code&gt;#facter -v&lt;/code&gt; &lt;br /&gt;
4.在客户端 &lt;br /&gt;
&lt;code&gt;#yum install puppet&lt;/code&gt;   &lt;/p&gt;
&lt;p&gt;5.配置 &lt;br /&gt;
- 5.1 主机名和host 文件的修改 &lt;br /&gt;
- 5.2 设置NTP时间同步 &lt;br /&gt;
    在crontab中加入：
&lt;code&gt;*/10 * * * *  ntpdate -s time.nist.gov&lt;/code&gt;&lt;br /&gt;
- 5.3 配置site.pp &lt;br /&gt;
&lt;code&gt;#vim /etc/puppet/manifests/site.pp&lt;/code&gt; &lt;br /&gt;
&lt;code&gt;node default { file {“/tmp/puppettest1.txt”: content =&amp;gt; “Hello World”;}}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;6.启动服务 &lt;br /&gt;
&lt;code&gt;#/etc/init.d/puppetmaster start&lt;/code&gt;  &lt;br /&gt;
&lt;code&gt;#chkconfig puppetmaster on&lt;/code&gt; &lt;br /&gt;
&lt;code&gt;#/etc/init.d/puppet start&lt;/code&gt;&lt;br /&gt;
&lt;code&gt;#chkconfig puppet on&lt;/code&gt;   &lt;/p&gt;
&lt;p&gt;7.客户端测试  &lt;br /&gt;
首先是发起验证&lt;br /&gt;
&lt;code&gt;# puppet agent --test --server server&lt;/code&gt;  &lt;br /&gt;
服务器端完成验证    &lt;br /&gt;
&lt;code&gt;#puppet cert --list&lt;/code&gt; &lt;br /&gt;
&lt;code&gt;#puppet cert sign agent.feisblog.com&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kevin</dc:creator><pubDate>Wed, 07 Jan 2015 10:30:00 +0800</pubDate><guid>tag:www.feisblog.com,2015-01-07:pages/2015/01/07/puppet_install/</guid><category>puppet</category></item></channel></rss>